<!DOCTYPE html>
<html lang="en">
  <head>
    <title>&lt;model-viewer&gt; example</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- The following libraries and polyfills are recommended to maximize browser support -->
    <!-- NOTE: you must adjust the paths as appropriate for your project -->

    <!-- üö® REQUIRED: Web Components polyfill to support Edge and Firefox < 63 -->
    <script src="https://unpkg.com/@webcomponents/webcomponentsjs@2.1.3/webcomponents-loader.js"></script>

    <!-- üíÅ OPTIONAL: Intersection Observer polyfill for better performance in Safari and IE11 -->
    <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>

    <!-- üíÅ OPTIONAL: Resize Observer polyfill improves resize behavior in non-Chrome browsers -->
    <script src="https://unpkg.com/resize-observer-polyfill@1.5.0/dist/ResizeObserver.js"></script>

    <!-- üíÅ OPTIONAL: The :focus-visible polyfill removes the focus ring for some input types -->
    <script
      src="https://unpkg.com/focus-visible@5.0.2/dist/focus-visible.js"
      defer
    ></script>
    <script src="./plugin/Bootstrap/jquery-3.6.0.slim.min.js"></script>
  </head>

  <body>
    <!-- src="./glb/1616.glb" 
  ios-src="./glb/1616.usdz"  -->

    <!-- src="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/Duck/glTF-Binary/Duck.glb" 
  ios-src="https://cdn.glitch.com/36cb8393-65c6-408d-a538-055ada20431b/Astronaut.usdz?v=1569545377878"  -->

    <model-viewer
      id="MVMVMV"
      camera-controls
      src="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/Duck/glTF-Binary/Duck.glb"
      ios-src="https://cdn.glitch.com/36cb8393-65c6-408d-a538-055ada20431b/Astronaut.usdz?v=1569545377878"
      ar
      ar-modes="webxr scene-viewer quick-look"
      alt="A 3D model of a helmet"
      style="width: 100%; height: 100vh"
    >
      <!-- Ê®°ÂûãÈÅ∏È†Ö -->
      <div class="controls">
        <h3>Model Select</h3>
        <div>
          <select id="ModelSelect">
            <option
              value="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/Duck/glTF-Binary/Duck.glb"
            >
              Duck
            </option>
            <option value="./glb/0431.glb">0431</option>
            <option value="./glb/08224.glb">08224</option>
            <option
              value="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
            >
              Space man
            </option>
          </select>
        </div>
      </div>
      <!-- ÊùêË≥™ Normal Occlusion Emission  -->
      <div class="controls">
        <h3>ÊùêË≥™ÈÅ∏Êìá</h3>
        <div>
          <p>Normals</p>
          <select id="normals">
            <option>None</option>
            <option value="https://i.imgur.com/euWRrtT.jpeg">0817</option>

            <option
              value="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/DamagedHelmet/glTF/Default_normal.jpg"
            >
              Damaged helmet
            </option>
            <option
              value="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/Lantern/glTF/Lantern_normal.png"
            >
              Lantern Pole
            </option>
            <option
              value="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/WaterBottle/glTF/WaterBottle_normal.png"
            >
              Water Bottle
            </option>
          </select>
        </div>
        <div>
          <p>Occlusion</p>
          <select id="occlusion">
            <option>None</option>
            <option value="https://i.imgur.com/euWRrtT.jpeg">0817</option>

            <option
              value="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/DamagedHelmet/glTF/Default_AO.jpg"
            >
              Damaged helmet
            </option>
            <option
              value="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/WaterBottle/glTF/WaterBottle_occlusionRoughnessMetallic.png"
            >
              Water Bottle
            </option>
          </select>
        </div>
        <div>
          <p>Emission</p>
          <select id="emission">
            <option>None</option>
            <option value="https://i.imgur.com/euWRrtT.jpeg">0817</option>

            <option
              value="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/DamagedHelmet/glTF/Default_emissive.jpg"
            >
              Damaged helmet
            </option>
            <option
              value="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/Lantern/glTF/Lantern_emissive.png"
            >
              Lantern Pole
            </option>
            <option
              value="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/WaterBottle/glTF/WaterBottle_emissive.png"
            >
              Water Bottle
            </option>
          </select>
        </div>
      </div>
      <!-- ÊùêË≥™ Metalness Roughness-->
      <div class="controls">
        <h3>ÊùêË≥™ Metalness Roughness</h3>
        <div>
          <p>Metalness: <span id="metalness-value"></span></p>
          <input
            id="metalness"
            type="range"
            min="0"
            max="1"
            step="0.01"
            value="1"
          />
        </div>
        <div>
          <p>Roughness: <span id="roughness-value"></span></p>
          <input
            id="roughness"
            type="range"
            min="0"
            max="1"
            step="0.01"
            value="0"
          />
        </div>
      </div>
      <!-- È°èËâ≤ -->
      <div class="controls">
        <h3>Color BaseFactor</h3>
        Color:
        <input
          id="color_pick"
          type="color"
          onchange="changeColor(event)"
        /><br /><br />
        <!-- Alpha: -->
        <!-- <input id="alpha-pick" type="color" value="1" onchange="changeAlpha()"> -->
      </div>
      <br />
      <!-- Light -->
      <div class="controls">
        <h3>ÂÖâÁ∑ö (Êï∏Â≠ó)</h3>
        <input type="text" id="A" value="1" />
        <button onclick="setData()">SetLight</button>
      </div>
      <!-- Env Light -->
      <br />
      <div class="controls">
        <h3>Áí∞Â¢ÉÂÖâÊ∫ê (ÂúñÁâáurl)</h3>
        <input type="text" id="B" value="https://i.imgur.com/IR4nF1m.jpeg" />
        <button onclick="setEnvUrl()">SetEnvImageUrl</button>
      </div>
    </model-viewer>

    <script type="module">
      // Ê®°ÂûãÈÅ∏Êìá
      const modelViewer = document.querySelector("#MVMVMV")

      document
        .querySelector("#ModelSelect")
        .addEventListener("input", (event) => {
          let Model_Url = event.target.value
          modelViewer.src = Model_Url
        })
    </script>

    <script type="module">
      // Texture ÈÅ∏Êìá
      const modelViewerTexture = document.querySelector("#MVMVMV")

      modelViewerTexture.addEventListener("load", () => {
        let material = modelViewerTexture.model.materials[0]

        let createAndApplyTexture = async (channel, event) => {
          if (event.target.value == "None") {
            console.log(event.target.value)
            material[channel].setTexture(null)
          } else {
            let texture = await modelViewerTexture.createTexture(
              event.target.value
            )
            material[channel].setTexture(texture)
          }
        }

        document
          .querySelector("#normals")
          .addEventListener("input", (event) => {
            console.log("normalTexture")
            console.log(event.target.value)
            createAndApplyTexture("normalTexture", event)
          })

        document
          .querySelector("#occlusion")
          .addEventListener("input", (event) => {
            createAndApplyTexture("occlusionTexture", event)
          })

        document
          .querySelector("#emission")
          .addEventListener("input", (event) => {
            console.log(event.target.value)
            createAndApplyTexture("emissiveTexture", event)
          })
      })
    </script>

    <script>
      // Metal Rough ÊùêË≥™Ë™øÊï¥
      const modelViewerParameters = document.querySelector("#MVMVMV")

      modelViewerParameters.addEventListener("load", (ev) => {
        let material = modelViewerParameters.model.materials[0]

        let metalnessDisplay = document.querySelector("#metalness-value")
        let roughnessDisplay = document.querySelector("#roughness-value")

        metalnessDisplay.textContent =
          material.pbrMetallicRoughness.metallicFactor
        roughnessDisplay.textContent =
          material.pbrMetallicRoughness.roughnessFactor

        document
          .querySelector("#metalness")
          .addEventListener("input", (event) => {
            material.pbrMetallicRoughness.setMetallicFactor(event.target.value)
            metalnessDisplay.textContent = event.target.value
          })

        document
          .querySelector("#roughness")
          .addEventListener("input", (event) => {
            material.pbrMetallicRoughness.setRoughnessFactor(event.target.value)
            roughnessDisplay.textContent = event.target.value
          })
      })
    </script>

    <script>
      function formatFloat(num, pos) {
        var size = Math.pow(10, pos)
        return Math.round(num * size) / size
      }

      // ÈÅ∏ÊìáÈ°èËâ≤
      const modelViewerColor = document.querySelector("#MVMVMV")

      function changeColor(ev) {
        let color = ev.target.value
        let r = parseInt(color.substr(1, 2), 16)
        let g = parseInt(color.substr(3, 2), 16)
        let b = parseInt(color.substr(5, 2), 16)
        console.log(`red: ${r}, green: ${g}, blue: ${b}`)

        let material = modelViewerColor.model.materials[0]
        console.log(material)
        r = formatFloat(r / 255, 4)
        g = formatFloat(g / 255, 4)
        b = formatFloat(b / 255, 4)
        let cc = `${r}, ${g}, ${b}, 1`
        cc = cc.split(",")

        material.pbrMetallicRoughness.setBaseColorFactor(cc)
      }
    </script>

    <script>
      function setData() {
        let a = $("#A").val()
        $("#MVMVMV").attr("exposure", a)
      }
    </script>
    <script>
      function setEnvUrl() {
        let b = $("#B").val()
        console.log(b)

        $("#MVMVMV").attr("environment-Image", b)
      }
    </script>

    <!-- üíÅ Include both scripts below to support all browsers! -->

    <!-- Loads <model-viewer> for modern browsers: -->
    <script
      type="module"
      src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"
    ></script>

    <!-- Loads <model-viewer> for old browsers like IE11: -->
    <script
      nomodule
      src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"
    ></script>
  </body>
</html>

<style>
  html {
    height: 100%;
  }

  body {
    min-height: 100%;
  }

  .controls {
    width: 20%;
    color: white;
  }

  #MVMVMV {
    background-image: url("./images/bg_AR.jpg");
    background-repeat: no-repeat;
    background-size: cover;
    background-position: center;
  }
</style>
